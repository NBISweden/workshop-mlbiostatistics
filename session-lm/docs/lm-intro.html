<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to linear models - 1&nbsp; Introduction to linear models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./lm-reg-cls.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./lm-intro.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to linear models</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to linear models</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm-intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm-reg-cls.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear models: regression and classification</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm-coeff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Common cases</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm-intro-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises (introduction to linear models)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm-diagn-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises (model diagnostics)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm-lasso-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises (regularization)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lm-coeff-exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises (regression coefficients)</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-linear-models" id="toc-why-linear-models" class="nav-link active" data-scroll-target="#why-linear-models"><span class="header-section-number">1.1</span> Why linear models?</a></li>
  <li><a href="#statistical-vs.-deterministic-relationship" id="toc-statistical-vs.-deterministic-relationship" class="nav-link" data-scroll-target="#statistical-vs.-deterministic-relationship"><span class="header-section-number">1.2</span> Statistical vs.&nbsp;deterministic relationship</a></li>
  <li><a href="#what-linear-models-are-and-are-not" id="toc-what-linear-models-are-and-are-not" class="nav-link" data-scroll-target="#what-linear-models-are-and-are-not"><span class="header-section-number">1.3</span> What linear models are and are not</a></li>
  <li><a href="#terminology" id="toc-terminology" class="nav-link" data-scroll-target="#terminology"><span class="header-section-number">1.4</span> Terminology</a></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression"><span class="header-section-number">1.5</span> Simple linear regression</a></li>
  <li><a href="#least-squares" id="toc-least-squares" class="nav-link" data-scroll-target="#least-squares"><span class="header-section-number">1.6</span> Least squares</a></li>
  <li><a href="#intercept-and-slope" id="toc-intercept-and-slope" class="nav-link" data-scroll-target="#intercept-and-slope"><span class="header-section-number">1.7</span> Intercept and Slope</a></li>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link" data-scroll-target="#hypothesis-testing"><span class="header-section-number">1.8</span> Hypothesis testing</a></li>
  <li><a href="#vector-matrix-notations" id="toc-vector-matrix-notations" class="nav-link" data-scroll-target="#vector-matrix-notations"><span class="header-section-number">1.9</span> Vector-matrix notations</a></li>
  <li><a href="#confidence-intervals-and-prediction-intervals" id="toc-confidence-intervals-and-prediction-intervals" class="nav-link" data-scroll-target="#confidence-intervals-and-prediction-intervals"><span class="header-section-number">1.10</span> Confidence intervals and prediction intervals</a></li>
  <li><a href="#assessing-model-fit" id="toc-assessing-model-fit" class="nav-link" data-scroll-target="#assessing-model-fit"><span class="header-section-number">1.11</span> Assessing model fit</a>
  <ul class="collapse">
  <li><a href="#r2-summary-of-the-fitted-model" id="toc-r2-summary-of-the-fitted-model" class="nav-link" data-scroll-target="#r2-summary-of-the-fitted-model"><span class="math inline">\(R^2\)</span>: summary of the fitted model</a></li>
  <li><a href="#r2-and-correlation-coefficient" id="toc-r2-and-correlation-coefficient" class="nav-link" data-scroll-target="#r2-and-correlation-coefficient"><span class="math inline">\(R^2\)</span> and correlation coefficient</a></li>
  <li><a href="#r2adj" id="toc-r2adj" class="nav-link" data-scroll-target="#r2adj"><span class="math inline">\(R^2(adj)\)</span></a></li>
  </ul></li>
  <li><a href="#the-assumptions-of-a-linear-model" id="toc-the-assumptions-of-a-linear-model" class="nav-link" data-scroll-target="#the-assumptions-of-a-linear-model"><span class="header-section-number">1.12</span> The assumptions of a linear model</a>
  <ul class="collapse">
  <li><a href="#checking-assumptions" id="toc-checking-assumptions" class="nav-link" data-scroll-target="#checking-assumptions"><span class="header-section-number">1.12.1</span> Checking assumptions</a></li>
  <li><a href="#influential-observations" id="toc-influential-observations" class="nav-link" data-scroll-target="#influential-observations"><span class="header-section-number">1.12.2</span> Influential observations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to linear models</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="why-linear-models" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="why-linear-models"><span class="header-section-number">1.1</span> Why linear models?</h2>
<p>With linear models we can answer questions such as:</p>
<ul>
<li>is there a relationship between exposure and outcome, e.g.&nbsp;height and weight?</li>
<li>how strong is the relationship between the two variables?</li>
<li>what will be a predicted value of the outcome given a new set of exposure values?</li>
<li>how accurately can we predict outcome?</li>
<li>which variables are associated with the response, e.g.&nbsp;is it only height that explains weight or could it be height and age that are both associated with the response?</li>
</ul>
<div class="cell" data-layout-align="center" data-fig-cap-location="bottom">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data_diabetes <span class="sc">%&gt;%</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> weight)) <span class="sc">+</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  my.ggtheme <span class="sc">+</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"height [m]"</span>) <span class="sc">+</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"weight [kg]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-scatter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/fig-scatter-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.1: Scatter plot of weight vs.&nbsp;height for the 130 study participants based on the diabetes data set collected to understand the prevalence of obesity, diabetes, and other cardiovascular risk factors in central Virginia, USA.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="statistical-vs.-deterministic-relationship" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="statistical-vs.-deterministic-relationship"><span class="header-section-number">1.2</span> Statistical vs.&nbsp;deterministic relationship</h2>
<p>Relationships in probability and statistics can generally be one of three things: deterministic, random, or statistical:</p>
<ul>
<li>a <strong>deterministic</strong> relationship involves <strong>an exact relationship</strong> between two variables, for instance Fahrenheit and Celsius degrees is defined by an equation <span class="math inline">\(Fahrenheit=\frac{9}{5}\cdot Celcius+32\)</span></li>
<li>there is <strong>no relationship</strong> between variables in the <strong>random relationship</strong>, for instance number of succulents Olga buys and time of the year as Olga keeps buying succulents whenever she feels like it throughout the entire year</li>
<li><strong>a statistical relationship</strong> is a <strong>mixture of deterministic and random relationship</strong>, e.g.&nbsp;the savings that Olga has left in the bank account depend on Olga’s monthly salary income (deterministic part) and the money spent on buying succulents (random part)</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-relationship" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/fig-relationship-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.2: Deterministic vs.&nbsp;statistical relationship: a) deterministic: equation exactly describes the relationship between the two variables e.g.&nbsp;Ferenheit and Celcius relationship, b) statistical relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> is not perfect (increasing relationship), c) statistical relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> is not perfect (decreasing relationship), d) random signal</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="what-linear-models-are-and-are-not" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="what-linear-models-are-and-are-not"><span class="header-section-number">1.3</span> What linear models are and are not</h2>
<ul>
<li><p>In an linear model we model (explain) the relationship between a single continuous variable <span class="math inline">\(Y\)</span> and one or more variables <span class="math inline">\(X\)</span>. The <span class="math inline">\(X\)</span> variables can be numerical, categorical or a mixture of both.</p></li>
<li><p>One very general form for the model would be: <span class="math display">\[Y = f(X_1, X_2, \dots X_p) + \epsilon\]</span> where <span class="math inline">\(f\)</span> is some unknown function and <span class="math inline">\(\epsilon\)</span> is the error in this representation.</p></li>
<li><p>For instance a <strong>simple linear regression</strong> through the origin is a simple linear model of the form <span class="math display">\[Y_i = \beta \cdot x + \epsilon\]</span> often used to express a relationship of <strong>one numerical variable to another</strong>, e.g.&nbsp;the calories burnt and the kilometers cycled.</p></li>
<li><p>Linear models can become quite advanced by including <strong>many variables</strong>, e.g.&nbsp;the calories burnt could be a function of the kilometers cycled, road incline and status of a bike, or the <strong>transformation of the variables</strong>, e.g.&nbsp;a function of kilometers cycled squared</p></li>
<li><p>Formally, linear models are a way of describing a response variable in terms of <strong>linear combination</strong> of predictor variables, i.e.&nbsp;expression constructed from a a set of terms by multiplying each term by a constant and/or adding the results.</p></li>
<li><p>For instance these are all models that can be constructed using linear combinations of predictors:</p></li>
</ul>
<div class="cell" data-fig-cap-location="margin">
<div class="cell-output-display">
<div id="fig-linear-adv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/fig-linear-adv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.3: Examples of a linear models: A) <span class="math inline">\(y_i = x_1 + e_i\)</span>, B) <span class="math inline">\(x_1 + I_{x_i} + e_i\)</span> C) <span class="math inline">\(y_i = x_i^2 + e_i\)</span>, D) <span class="math inline">\(y_i = x + x_i^3 + e_i\)</span> showing that linear models can get more complex and/or capture more than a straight line relationship.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><span class="math inline">\(Y_i = \alpha + \beta x_i + \gamma y_i + \epsilon_i\)</span></li>
<li><span class="math inline">\(Y_i = \alpha + \beta x_i^2 \epsilon\)</span></li>
<li><span class="math inline">\(Y_i = \alpha + \beta x_i^2 + \gamma x_i^3 + \epsilon\)</span></li>
<li><span class="math inline">\(Y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 y_i + \beta_4 \sqrt {y_i} + \beta_5 x_i y_i + \epsilon\)</span></li>
</ul>
<p>vs.&nbsp;an example of a non-linear model where parameter <span class="math inline">\(\beta\)</span> appears in the exponent of <span class="math inline">\(x_i\)</span></p>
<ul>
<li><span class="math inline">\(Y_i = \alpha + x_i^\beta + \epsilon\)</span></li>
</ul>
</section>
<section id="terminology" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="terminology"><span class="header-section-number">1.4</span> Terminology</h2>
<p>There are many terms and notations used interchangeably:</p>
<ul>
<li><span class="math inline">\(y\)</span> is being called:
<ul>
<li>response</li>
<li>outcome</li>
<li>dependent variable</li>
</ul></li>
<li><span class="math inline">\(x\)</span> is being called:
<ul>
<li>exposure</li>
<li>explanatory variable</li>
<li>independent variable</li>
<li>predictor</li>
<li>covariate</li>
</ul></li>
</ul>
</section>
<section id="simple-linear-regression" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="simple-linear-regression"><span class="header-section-number">1.5</span> Simple linear regression</h2>
<ul>
<li>It is used to check the association between <strong>the numerical outcome and one numerical explanatory variable</strong></li>
<li>In practice, we are finding the best-fitting straight line to describe the relationship between the outcome and exposure</li>
</ul>
<div id="exm-simple-lm" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.1 (Weight and plasma volume) </strong></span>Let’s look at the example data containing body weight (kg) and plasma volume (liters) for eight healthy men to see what the best-fitting straight line is.</p>
<p>Example data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">58</span>, <span class="dv">70</span>, <span class="dv">74</span>, <span class="fl">63.5</span>, <span class="fl">62.0</span>, <span class="fl">70.5</span>, <span class="fl">71.0</span>, <span class="fl">66.0</span>) <span class="co"># body weight (kg)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>plasma <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.75</span>, <span class="fl">2.86</span>, <span class="fl">3.37</span>, <span class="fl">2.76</span>, <span class="fl">2.62</span>, <span class="fl">3.49</span>, <span class="fl">3.05</span>, <span class="fl">3.12</span>) <span class="co"># plasma volume (liters)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell" data-fig-cap-location="margin" data-fig-heigth="4">
<div class="cell-output-display">
<div id="fig-lm-intro-example" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/fig-lm-intro-example-1.png" class="img-fluid figure-img" width="384"></p>
<figcaption class="figure-caption">Figure&nbsp;1.4: Scatter plot of the data shows that high plasma volume tends to be associated with high weight and <em>vice verca</em>.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-fig-cap-location="margin" data-fig-heigth="4">
<div class="cell-output-display">
<div id="fig-lm-example-reg" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/fig-lm-example-reg-1.png" class="img-fluid figure-img" width="384"></p>
<figcaption class="figure-caption">Figure&nbsp;1.5: Scatter plot of the data shows that high plasma volume tends to be associated with high weight and <em>vice verca</em>. Linear regression gives the equation of the straight line (red) that best describes how the outcome changes (increase or decreases) with a change of exposure variable</figcaption>
</figure>
</div>
</div>
</div>
<p>The equation for the red line is: <span class="math display">\[Y_i=0.086 +  0.044 \cdot x_i \quad for \;i = 1 \dots 8\]</span> and in general: <span class="math display">\[Y_i=\alpha + \beta \cdot x_i \quad for \; i = 1 \dots n\]</span></p>
<ul>
<li>In other words, by finding the best-fitting straight line we are <strong>building a statistical model</strong> to represent the relationship between plasma volume (<span class="math inline">\(Y\)</span>) and explanatory body weight variable (<span class="math inline">\(x\)</span>)</li>
<li>If we were to use our model <span class="math inline">\(Y_i=0.086 + 0.044 \cdot x_i\)</span> to find plasma volume given a weight of 58 kg (our first observation, <span class="math inline">\(i=1\)</span>), we would notice that we would get <span class="math inline">\(Y=0.086 + 0.044 \cdot 58 = 2.638\)</span>, not exactly <span class="math inline">\(2.75\)</span> as we have for our first man in our dataset that we started with, i.e.&nbsp;<span class="math inline">\(2.75 - 2.638 = 0.112 \neq 0\)</span>.</li>
<li>We thus add to the above equation an <strong>error term</strong> to account for this and now we can write our <strong>simple regression model</strong> more formally as:</li>
</ul>
<p><span id="eq-lm"><span class="math display">\[Y_i = \alpha + \beta \cdot x_i + \epsilon_i \tag{1.1}\]</span></span> where:</p>
<ul>
<li><span class="math inline">\(x\)</span>: is called: exposure variable, explanatory variable, dependent variable, predictor, covariate</li>
<li><span class="math inline">\(y\)</span>: is called: response, outcome, dependent variable</li>
<li><span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are <strong>model coefficients</strong></li>
<li>and <span class="math inline">\(\epsilon_i\)</span> is an <strong>error terms</strong></li>
</ul>
</section>
<section id="least-squares" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="least-squares"><span class="header-section-number">1.6</span> Least squares</h2>
<ul>
<li>in the above <strong>“body weight - plasma volume”</strong> example, the values of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> have just appeared</li>
<li>in practice, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> values are unknown and we use data to <strong>estimate these coefficients</strong>, noting the estimates with a <strong>hat</strong>, <span class="math inline">\(\hat{\alpha}\)</span> and <span class="math inline">\(\hat{\beta}\)</span></li>
<li><strong>least squares</strong> is one of the methods of parameters estimation, i.e.&nbsp;finding <span class="math inline">\(\hat{\alpha}\)</span> and <span class="math inline">\(\hat{\beta}\)</span></li>
</ul>
<div class="cell" data-fig-cap-location="margin">
<div class="cell-output-display">
<div id="fig-reg-errors" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/fig-reg-errors-1.png" class="img-fluid figure-img" width="384"></p>
<figcaption class="figure-caption">Figure&nbsp;1.6: Scatter plot of the data shows that high plasma volume tends to be associated with high weight and <em>vice verca</em>. Linear regrssion gives the equation of the straight line (red) that best describes how the outcome changes with a change of exposure variable. Blue lines represent error terms, the vertical distances to the regression line</figcaption>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Let <span class="math inline">\(\hat{y_i}=\hat{\alpha} + \hat{\beta}x_i\)</span> be the prediction <span class="math inline">\(y_i\)</span> based on the <span class="math inline">\(i\)</span>-th value of <span class="math inline">\(x\)</span>:</p>
<ul>
<li>Then <span class="math inline">\(\epsilon_i = y_i - \hat{y_i}\)</span> represents the <span class="math inline">\(i\)</span>-th <strong>residual</strong>, i.e.&nbsp;the difference between the <span class="math inline">\(i\)</span>-th observed response value and the <span class="math inline">\(i\)</span>-th response value that is predicted by the linear model</li>
<li>RSS, the <strong>residual sum of squares</strong> is defined as: <span class="math display">\[RSS = \epsilon_1^2 + \epsilon_2^2 + \dots + \epsilon_n^2\]</span> or equivalently as: <span class="math display">\[RSS=(y_1-\hat{\alpha}-\hat{\beta}x_1)^2+(y_2-\hat{\alpha}-\hat{\beta}x_2)^2+...+(y_n-\hat{\alpha}-\hat{\beta}x_n)^2\]</span></li>
<li>the least squares approach chooses <span class="math inline">\(\hat{\alpha}\)</span> and <span class="math inline">\(\hat{\beta}\)</span> <strong>to minimize the RSS</strong>. With some calculus, a good video explanation for the interested ones is <a href="https://www.youtube.com/watch?v=ewnc1cXJmGA">here</a>, we get <a href="#thm-lss">Theorem&nbsp;<span>1.1</span></a></li>
</ul>
<div id="thm-lss" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1.1 (Least squares estimates for a simple linear regression) </strong></span><span class="math display">\[\hat{\beta} = \frac{S_{xy}}{S_{xx}}\]</span> <span class="math display">\[\hat{\alpha} = \bar{y}-\frac{S_{xy}}{S_{xx}}\cdot \bar{x}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\bar{x}\)</span>: mean value of <span class="math inline">\(x\)</span></li>
<li><span class="math inline">\(\bar{y}\)</span>: mean value of <span class="math inline">\(y\)</span></li>
<li><span class="math inline">\(S_{xx}\)</span>: sum of squares of <span class="math inline">\(X\)</span> defined as <span class="math inline">\(S_{xx} = \displaystyle \sum_{i=1}^{n}(x_i-\bar{x})^2\)</span></li>
<li><span class="math inline">\(S_{yy}\)</span>: sum of squares of <span class="math inline">\(Y\)</span> defined as <span class="math inline">\(S_{yy} = \displaystyle \sum_{i=1}^{n}(y_i-\bar{y})^2\)</span></li>
<li><span class="math inline">\(S_{xy}\)</span>: sum of products of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> defined as <span class="math inline">\(S_{xy} = \displaystyle \sum_{i=1}^{n}(x_i-\bar{x})(y_i-\bar{y})\)</span></li>
</ul>
</div>
<!-- We can further re-write the above sum of squares to obtain -->
<!-- - sum of squares of $X$, $$S_{xx} = \displaystyle \sum_{i=1}^{n}(x_i-\bar{x})^2 = \sum_{i=1}^{n}x_i^2-\frac{(\sum_{i=1}^{n}x_i)^2}{n})$$ -->
<!-- - sum of products of $X$ and $Y$ -->
<!-- $$S_{xy} = \displaystyle \sum_{i=1}^{n}(x_i-\bar{x})(y_i-\bar{y})=\sum_{i=1}^nx_iy_i-\frac{\sum_{i=1}^{n}x_i\sum_{i=1}^{n}y_i}{n}$$ -->
<div id="exm-lss" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.2 (Least squares) </strong></span>Let’s try least squares method to find coefficient estimates in the <strong>“body weight and plasma volume example”</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initial data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">58</span>, <span class="dv">70</span>, <span class="dv">74</span>, <span class="fl">63.5</span>, <span class="fl">62.0</span>, <span class="fl">70.5</span>, <span class="fl">71.0</span>, <span class="fl">66.0</span>) <span class="co"># body weight (kg)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>plasma <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.75</span>, <span class="fl">2.86</span>, <span class="fl">3.37</span>, <span class="fl">2.76</span>, <span class="fl">2.62</span>, <span class="fl">3.49</span>, <span class="fl">3.05</span>, <span class="fl">3.12</span>) <span class="co"># plasma volume (liters)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># rename variables for convenience</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> weight</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> plasma</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mean values of x and y</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>x.bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>y.bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum of squares</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>Sxx <span class="ot">&lt;-</span>  <span class="fu">sum</span>((x <span class="sc">-</span> x.bar)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>Sxy <span class="ot">&lt;-</span> <span class="fu">sum</span>((x<span class="sc">-</span>x.bar)<span class="sc">*</span>(y<span class="sc">-</span>y.bar))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Coefficient estimates</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>beta.hat <span class="ot">&lt;-</span> Sxy <span class="sc">/</span> Sxx</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>alpha.hat <span class="ot">&lt;-</span> y.bar <span class="sc">-</span> Sxy<span class="sc">/</span>Sxx<span class="sc">*</span>x.bar</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Print estimated coefficients alpha and beta</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(alpha.hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08572428</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(beta.hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.04361534</code></pre>
</div>
</div>
</div>
<p>In R we can use <code>lm()</code>, the built-in function, to fit a linear regression model and we can replace the above code with one line</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(plasma <span class="sc">~</span> weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = plasma ~ weight)

Coefficients:
(Intercept)       weight  
    0.08572      0.04362  </code></pre>
</div>
</div>
</section>
<section id="intercept-and-slope" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="intercept-and-slope"><span class="header-section-number">1.7</span> Intercept and Slope</h2>
<ul>
<li>Linear regression gives us estimates of model coefficient <span class="math inline">\(Y_i = \alpha + \beta x_i + \epsilon_i\)</span></li>
<li><span class="math inline">\(\alpha\)</span> is known as the <strong>intercept</strong></li>
<li><span class="math inline">\(\beta\)</span> is known as the <strong>slope</strong></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-lm-parameters" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/fig-lm-parameters-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1.7: Scatter plot of the data shows that high plasma volume tends to be associated with high weight and <em>vice verca</em>. Linear regression gives the equation of the straight line that best describes how the outcome changes (increase or decreases) with a change of exposure variable (in red)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="hypothesis-testing" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="hypothesis-testing"><span class="header-section-number">1.8</span> Hypothesis testing</h2>
<p><strong>Is there a relationship between the response and the predictor?</strong></p>
<ul>
<li>the calculated <span class="math inline">\(\hat{\alpha}\)</span> and <span class="math inline">\(\hat{\beta}\)</span> are <strong>estimates of the population values</strong> of the intercept and slope and are therefore subject to <strong>sampling variation</strong></li>
<li>their precision is measured by their <strong>estimated standard errors</strong>, <code>e.s.e</code>(<span class="math inline">\(\hat{\alpha}\)</span>) and <code>e.s.e</code>(<span class="math inline">\(\hat{\beta}\)</span>)</li>
<li>these estimated standard errors are used in <strong>hypothesis testing</strong> and in constructing <strong>confidence and prediction intervals</strong></li>
</ul>
<p><strong>The most common hypothesis test</strong> involves testing the <code>null hypothesis</code> of:</p>
<ul>
<li><span class="math inline">\(H_0:\)</span> There is no relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span></li>
<li>versus the <code>alternative hypothesis</code> <span class="math inline">\(H_a:\)</span> there is some relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span></li>
</ul>
<p><strong>Mathematically</strong>, this corresponds to testing:</p>
<ul>
<li><span class="math inline">\(H_0: \beta=0\)</span></li>
<li>versus <span class="math inline">\(H_a: \beta\neq0\)</span></li>
<li>since if <span class="math inline">\(\beta=0\)</span> then the model <span class="math inline">\(Y_i=\alpha+\beta x_i + \epsilon_i\)</span> reduces to <span class="math inline">\(Y=\alpha + \epsilon_i\)</span></li>
</ul>
<p><strong>Under the null hypothesis</strong> <span class="math inline">\(H_0: \beta = 0\)</span> <!-- we have: $$\frac{\hat{\beta}-\beta}{e.s.e(\hat{\beta})} \sim t(n-p)$$  --> <img src="figures/linear-models/lm-tstatistics.png" class="img-fluid"></p>
<ul>
<li><span class="math inline">\(n\)</span> is number of observations</li>
<li><span class="math inline">\(p\)</span> is number of model parameters</li>
<li><span class="math inline">\(\frac{\hat{\beta}-\beta}{e.s.e(\hat{\beta})}\)</span> is the ratio of the departure of the estimated value of a parameter, <span class="math inline">\(\hat\beta\)</span>, from its hypothesized value, <span class="math inline">\(\beta\)</span>, to its standard error, called <code>t-statistics</code></li>
<li>the <code>t-statistics</code> follows Student’s t distribution with <span class="math inline">\(n-p\)</span> degrees of freedom</li>
</ul>
<div id="exm-hypothesis-testing" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.3 (Hypothesis testing) </strong></span>Let’s look again at our example data. This time we will not only fit the linear regression model but also look a bit more closely at the <code>R summary</code> of the model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">58</span>, <span class="dv">70</span>, <span class="dv">74</span>, <span class="fl">63.5</span>, <span class="fl">62.0</span>, <span class="fl">70.5</span>, <span class="fl">71.0</span>, <span class="fl">66.0</span>) <span class="co"># body weight (kg)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>plasma <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.75</span>, <span class="fl">2.86</span>, <span class="fl">3.37</span>, <span class="fl">2.76</span>, <span class="fl">2.62</span>, <span class="fl">3.49</span>, <span class="fl">3.05</span>, <span class="fl">3.12</span>) <span class="co"># plasma volume (liters)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(plasma <span class="sc">~</span> weight)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = plasma ~ weight)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.27880 -0.14178 -0.01928  0.13986  0.32939 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)  0.08572    1.02400   0.084   0.9360  
weight       0.04362    0.01527   2.857   0.0289 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2188 on 6 degrees of freedom
Multiple R-squared:  0.5763,    Adjusted R-squared:  0.5057 
F-statistic:  8.16 on 1 and 6 DF,  p-value: 0.02893</code></pre>
</div>
</div>
</div>
<ul>
<li>Under <code>Estimate</code> we see estimates of our model coefficients, <span class="math inline">\(\hat{\alpha}\)</span> (intercept) and <span class="math inline">\(\hat{\beta}\)</span> (slope, here weight), followed by their estimated standard errors, <code>Std. Errors</code></li>
<li>If we were to test if there is an <strong>association between weight and plasma volume</strong> we would write under the null hypothesis <span class="math inline">\(H_0: \beta = 0\)</span> <span class="math display">\[\frac{\hat{\beta}-\beta}{e.s.e(\hat{\beta})} = \frac{0.04362-0}{0.01527} = 2.856582\]</span></li>
<li>and we would <strong>compare</strong> <code>t-statistics</code> to <code>Student's t distribution</code> with <span class="math inline">\(n-p = 8 - 2 = 6\)</span> degrees of freedom (as we have 8 observations and two model parameters, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span>)</li>
<li>we can use <strong>Student’s t distribution table</strong> or <strong>R code</strong> to obtain the associated <em>P</em>-value</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>(<span class="fl">2.856582</span>, <span class="at">df=</span><span class="dv">6</span>, <span class="at">lower=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02893095</code></pre>
</div>
</div>
<ul>
<li>here the observed t-statistics is large and therefore yields a small <em>P</em>-value, meaning that <strong>there is sufficient evidence to reject null hypothesis in favor of the alternative</strong> and conclude that there is a significant association between weight and plasma volume</li>
</ul>
</section>
<section id="vector-matrix-notations" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="vector-matrix-notations"><span class="header-section-number">1.9</span> Vector-matrix notations</h2>
<p>While in simple linear regression it is feasible to arrive at the parameters estimates using calculus in more realistic settings of <strong>multiple regression</strong>, with more than one explanatory variable in the model, it is <strong>more efficient to use vectors and matrices to define the regression model</strong>.</p>
<p>Let’s <strong>rewrite</strong> our simple linear regression model <span class="math inline">\(Y_i = \alpha + \beta_i + \epsilon_i \quad i=1,\dots n\)</span> <strong>into vector-matrix notation</strong> in <strong>6 steps</strong>.</p>
<ol type="1">
<li><p>First we rename our <span class="math inline">\(\alpha\)</span> to <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta\)</span> to <span class="math inline">\(\beta_1\)</span> as it is easier to keep tracking the number of model parameters this way</p></li>
<li><p>Then we notice that we actually have <span class="math inline">\(n\)</span> equations such as: <span class="math display">\[y_1 = \beta_0 + \beta_1 x_1 + \epsilon_1\]</span> <span class="math display">\[y_2 = \beta_0 + \beta_1 x_2 + \epsilon_2\]</span> <span class="math display">\[y_3 = \beta_0 + \beta_1 x_3 + \epsilon_3\]</span> <span class="math display">\[\dots\]</span> <span class="math display">\[y_n = \beta_0 + \beta_1 x_n + \epsilon_n\]</span></p></li>
<li><p>We group all <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(\epsilon_i\)</span> into column vectors: <span class="math inline">\(\mathbf{Y}=\begin{bmatrix}  y_1 \\  y_2 \\  \vdots \\  y_{n} \end{bmatrix}\)</span> and <span class="math inline">\(\boldsymbol\epsilon=\begin{bmatrix}  \epsilon_1 \\  \epsilon_2 \\  \vdots \\  \epsilon_{n} \end{bmatrix}\)</span></p></li>
<li><p>We stack two parameters <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> into another column vector:<span class="math display">\[\boldsymbol\beta=\begin{bmatrix}
  \beta_0  \\
  \beta_1
\end{bmatrix}\]</span></p></li>
<li><p>We append a vector of ones with the single predictor for each <span class="math inline">\(i\)</span> and create a matrix with two columns called <strong>design matrix</strong> <span class="math display">\[\mathbf{X}=\begin{bmatrix}
  1 &amp; x_1  \\
  1 &amp; x_2  \\
  \vdots &amp; \vdots \\
  1 &amp; x_{n}
\end{bmatrix}\]</span></p></li>
<li><p>We write our linear model in a vector-matrix notations as: <span class="math display">\[\mathbf{Y} = \mathbf{X}\boldsymbol\beta + \boldsymbol\epsilon\]</span></p></li>
</ol>
<div id="def-vector-matrix-lm" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 1.1 (vector matrix form of the linear model) </strong></span>The vector-matrix representation of a linear model with <span class="math inline">\(p-1\)</span> predictors can be written as <span class="math display">\[\mathbf{Y} = \mathbf{X}\boldsymbol\beta + \boldsymbol\epsilon\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mathbf{Y}\)</span> is <span class="math inline">\(n \times1\)</span> vector of observations</li>
<li><span class="math inline">\(\mathbf{X}\)</span> is <span class="math inline">\(n \times p\)</span> <strong>design matrix</strong></li>
<li><span class="math inline">\(\boldsymbol\beta\)</span> is <span class="math inline">\(p \times1\)</span> vector of parameters</li>
<li><span class="math inline">\(\boldsymbol\epsilon\)</span> is <span class="math inline">\(n \times1\)</span> vector of vector of random errors, indepedent and identically distributed (i.i.d) N(0, <span class="math inline">\(\sigma^2\)</span>)</li>
</ul>
<p>In full, the above vectors and matrix have the form:</p>
<p><span class="math inline">\(\mathbf{Y}=\begin{bmatrix}  y_1 \\  y_2 \\  \vdots \\  y_{n} \end{bmatrix}\)</span> <span class="math inline">\(\boldsymbol\beta=\begin{bmatrix}  \beta_0 \\  \beta_1 \\  \vdots \\  \beta_{p} \end{bmatrix}\)</span> <span class="math inline">\(\boldsymbol\epsilon=\begin{bmatrix}  \epsilon_1 \\  \epsilon_2 \\  \vdots \\  \epsilon_{n} \end{bmatrix}\)</span> <span class="math inline">\(\mathbf{X}=\begin{bmatrix}  1 &amp; x_{1,1} &amp; \dots &amp; x_{1,p-1} \\  1 &amp; x_{2,1} &amp; \dots &amp; x_{2,p-1} \\  \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\  1 &amp; x_{n,1} &amp; \dots &amp; x_{n,p-1} \end{bmatrix}\)</span></p>
</div>
<div id="thm-lss-vector-matrix" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1.2 (Least squares in vector-matrix notation) </strong></span>The least squares estimates for a linear regression of the form: <span class="math display">\[\mathbf{Y} = \mathbf{X}\boldsymbol\beta + \boldsymbol\epsilon\]</span></p>
<p>is given by: <span class="math display">\[\hat{\mathbf{\beta}}= (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}\]</span></p>
</div>
<div id="exm-vector-matrix-notation" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.4 (vector-matrix-notation) </strong></span>Following the above definition we can write the <strong>“weight - plasma volume model”</strong> as: <span class="math display">\[\mathbf{Y} = \mathbf{X}\boldsymbol\beta + \boldsymbol\epsilon\]</span> where:</p>
<p><span class="math inline">\(\mathbf{Y}=\begin{bmatrix}  2.75 \\ 2.86 \\ 3.37 \\ 2.76 \\ 2.62 \\ 3.49 \\ 3.05 \\ 3.12 \end{bmatrix}\)</span></p>
<p><span class="math inline">\(\boldsymbol\beta=\begin{bmatrix}  \beta_0 \\  \beta_1 \end{bmatrix}\)</span> <span class="math inline">\(\boldsymbol\epsilon=\begin{bmatrix}  \epsilon_1 \\  \epsilon_2 \\  \vdots \\  \epsilon_{8} \end{bmatrix}\)</span> <span class="math inline">\(\mathbf{X}=\begin{bmatrix}  1 &amp; 58.0 \\  1 &amp; 70.0 \\  1 &amp; 74.0 \\  1 &amp; 63.5 \\  1 &amp; 62.0 \\  1 &amp; 70.5 \\  1 &amp; 71.0 \\  1 &amp; 66.0 \\ \end{bmatrix}\)</span></p>
<p>and we can estimate model parameters using <span class="math inline">\(\hat{\mathbf{\beta}}= (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}\)</span>.</p>
<p>We can do it by hand or in <code>R</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(plasma) <span class="co"># no. of observation</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(plasma, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">length=</span>n), weight)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print Y and X to double-check that the format is according to the definition</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]
[1,] 2.75
[2,] 2.86
[3,] 3.37
[4,] 2.76
[5,] 2.62
[6,] 3.49
[7,] 3.05
[8,] 3.12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       weight
[1,] 1   58.0
[2,] 1   70.0
[3,] 1   74.0
[4,] 1   63.5
[5,] 1   62.0
[6,] 1   70.5
[7,] 1   71.0
[8,] 1   66.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># least squares estimate</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># solve() finds inverse of matrix</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>beta.hat <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)<span class="sc">%*%</span>Y</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(beta.hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]
       0.08572428
weight 0.04361534</code></pre>
</div>
</div>
</div>
</section>
<section id="confidence-intervals-and-prediction-intervals" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="confidence-intervals-and-prediction-intervals"><span class="header-section-number">1.10</span> Confidence intervals and prediction intervals</h2>
<ul>
<li>when we estimate coefficients we can also find their <strong>confidence intervals</strong>, typically 95% confidence intervals, i.e.&nbsp;a range of values that contain the true unknown value of the parameter</li>
<li>we can also use linear regression models to predict the response value given a new observation and find <strong>prediction intervals</strong>. Here, we look at any specific value of <span class="math inline">\(x_i\)</span>, and find an interval around the predicted value <span class="math inline">\(y_i'\)</span> for <span class="math inline">\(x_i\)</span> such that there is a 95% probability that the real value of y (in the population) corresponding to <span class="math inline">\(x_i\)</span> is within this interval</li>
</ul>
<div id="exm-prediction-and-intervals" class="theorem example">
<p><span class="theorem-title"><strong>Example 1.5 (Prediction and intervals) </strong></span>Let’s:</p>
<ul>
<li>find confidence intervals for our coefficient estimates</li>
<li>predict plasma volume for a men weighting 60 kg</li>
<li>find prediction interval</li>
<li>plot original data, fitted regression model, predicted observation and prediction interval</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit regression model</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(plasma <span class="sc">~</span> weight)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = plasma ~ weight)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.27880 -0.14178 -0.01928  0.13986  0.32939 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)  0.08572    1.02400   0.084   0.9360  
weight       0.04362    0.01527   2.857   0.0289 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2188 on 6 degrees of freedom
Multiple R-squared:  0.5763,    Adjusted R-squared:  0.5057 
F-statistic:  8.16 on 1 and 6 DF,  p-value: 0.02893</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find confidence intervals for the model coefficients</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   2.5 %     97.5 %
(Intercept) -2.419908594 2.59135716
weight       0.006255005 0.08097567</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict plasma volume for a new observation of 60 kg</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we have to create data frame with a variable name matching the one used to build the model</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>new.obs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> <span class="dv">60</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata =</span> new.obs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1 
2.702645 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># find prediction intervals</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>prediction.interval <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> new.obs,  <span class="at">interval =</span> <span class="st">"prediction"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(prediction.interval)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 2.702645 2.079373 3.325916</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the original data, fitted regression and predicted value</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(weight, plasma, <span class="at">pch=</span><span class="dv">19</span>, <span class="at">xlab=</span><span class="st">"weight [kg]"</span>, <span class="at">ylab=</span><span class="st">"plasma [l]"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(weight, model<span class="sc">$</span>fitted.values, <span class="at">col=</span><span class="st">"red"</span>) <span class="co"># fitted model in red</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(new.obs, <span class="fu">predict</span>(model, <span class="at">newdata =</span> new.obs), <span class="at">pch=</span><span class="dv">19</span>, <span class="at">col=</span><span class="st">"blue"</span>) <span class="co"># predicted value at 60kg</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">60</span>, prediction.interval[<span class="dv">2</span>], <span class="dv">60</span>, prediction.interval[<span class="dv">3</span>], <span class="at">lty =</span> <span class="dv">3</span>) <span class="co"># add prediction interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm-intro_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</section>
<section id="assessing-model-fit" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="assessing-model-fit"><span class="header-section-number">1.11</span> Assessing model fit</h2>
<ul>
<li>Earlier we learned how to estimate parameters in a liner model using least squares estimation.</li>
<li>Now we will consider how to assess the goodness of fit of a model, i.e.&nbsp;how well does the model explain our data.</li>
<li>We do that by calculating the amount of variability in the response that is explained by the model.</li>
</ul>
<section id="r2-summary-of-the-fitted-model" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="r2-summary-of-the-fitted-model"><span class="math inline">\(R^2\)</span>: summary of the fitted model</h3>
<ul>
<li>considering a simple linear regression, the simplest model, <strong>Model 0</strong>, we could consider fitting is <span class="math display">\[Y_i = \beta_0+ \epsilon_i\]</span> that corresponds to a line that run through the data but lies parallel to the horizontal axis</li>
<li>in our plasma volume example that would correspond the mean value of plasma volume being predicted for any value of weight (in purple)</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>TSS, denoted <strong>Total corrected sum-of-squares</strong> is the residual sum-of-squares for Model 0 <span class="math display">\[S(\hat{\beta_0}) = TSS = \sum_{i=1}^{n}(y_i - \bar{y})^2 = S_{yy}\]</span> corresponding the to the sum of squared distances to the purple line</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Fitting <strong>Model 1</strong> of the form <span class="math display">\[Y_i = \beta_0 + \beta_1x + \epsilon_i\]</span> we have earlier defined</li>
<li><strong>RSS</strong>, the residual sum-of-squares as: <span class="math display">\[RSS = \displaystyle \sum_{i=1}^{n}(y_i - \{\hat{\beta_0} + \hat{\beta}_1x_{1i} + \dots + \hat{\beta}_px_{pi}\}) = \sum_{i=1}^{n}(y_i - \hat{y_i})^2\]</span></li>
<li>that corresponds to the squared distances between the observed values <span class="math inline">\(y_i, \dots,y_n\)</span> to fitted values <span class="math inline">\(\hat{y_1}, \dots \hat{y_n}\)</span>, i.e.&nbsp;distances to the red fitted line</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<div id="def-r2" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 1.2 (<span class="math inline">\(R^2\)</span>) </strong></span>A simple but useful measure of model fit is given by <span class="math display">\[R^2 = 1 - \frac{RSS}{TSS}\]</span> where:</p>
<ul>
<li>RSS is the residual sum-of-squares for Model 1, the fitted model of interest</li>
<li>TSS is the sum of squares of the <strong>null model</strong></li>
</ul>
</div>
<ul>
<li><span class="math inline">\(R^2\)</span> quantifies how much of a drop in the residual sum-of-squares is accounted for by fitting the proposed model</li>
<li><span class="math inline">\(R^2\)</span> is also referred as <strong>coefficient of determination</strong></li>
<li>It is expressed on a scale, as a proportion (between 0 and 1) of the total variation in the data</li>
<li>Values of <span class="math inline">\(R^2\)</span> approaching 1 indicate the model to be a good fit</li>
<li>Values of <span class="math inline">\(R^2\)</span> less than 0.5 suggest that the model gives rather a poor fit to the data</li>
</ul>
</section>
<section id="r2-and-correlation-coefficient" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="r2-and-correlation-coefficient"><span class="math inline">\(R^2\)</span> and correlation coefficient</h3>
<div id="thm-r2" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1.3 (<span class="math inline">\(R^2\)</span>) </strong></span>In the case of simple linear regression:</p>
<p>Model 1: <span class="math inline">\(Y_i = \beta_0 + \beta_1x + \epsilon_i\)</span> <span class="math display">\[R^2 = r^2\]</span> where:</p>
<ul>
<li><span class="math inline">\(R^2\)</span> is the coefficient of determination</li>
<li><span class="math inline">\(r^2\)</span> is the sample correlation coefficient</li>
</ul>
</div>
</section>
<section id="r2adj" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="r2adj"><span class="math inline">\(R^2(adj)\)</span></h3>
<ul>
<li>in the case of multiple linear regression, where there is more than one explanatory variable in the model</li>
<li>we are using the adjusted version of <span class="math inline">\(R^2\)</span> to assess the model fit</li>
<li>as the number of explanatory variables increase, <span class="math inline">\(R^2\)</span> also increases</li>
<li><span class="math inline">\(R^2(adj)\)</span> takes this into account, i.e.&nbsp;adjusts for the fact that there is more than one explanatory variable in the model</li>
</ul>
<div id="thm-r2adj" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1.4 (<span class="math inline">\(R^2(adj)\)</span>) </strong></span>For any multiple linear regression <span class="math display">\[Y_i = \beta_0 + \beta_1x_{1i} + \dots + \beta_{p-1}x_{(p-1)i} +  \epsilon_i\]</span> <span class="math inline">\(R^2(adj)\)</span> is defined as <span class="math display">\[R^2(adj) = 1-\frac{\frac{RSS}{n-p-1}}{\frac{TSS}{n-1}}\]</span> where</p>
<ul>
<li><span class="math inline">\(p\)</span> is the number of independent predictors, i.e.&nbsp;the number of variables in the model, excluding the constant</li>
</ul>
<p><span class="math inline">\(R^2(adj)\)</span> can also be calculated from <span class="math inline">\(R^2\)</span>: <span class="math display">\[R^2(adj) = 1 - (1-R^2)\frac{n-1}{n-p-1}\]</span></p>
</div>
<!-- We can calculate the values in R and compare the results to the output of linear regression -->
</section>
</section>
<section id="the-assumptions-of-a-linear-model" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="the-assumptions-of-a-linear-model"><span class="header-section-number">1.12</span> The assumptions of a linear model</h2>
<p>Up until now we were fitting models and discussed how to assess the model fit. Before making use of a fitted model for explanation or prediction, it is wise to check that the model provides an adequate description of the data. Informally we have been using box plots and scatter plots to look at the data. There are however formal definitions of the assumptions.</p>
<p><strong>Assumption A: The deterministic part of the model captures all the non-random structure in the data</strong></p>
<ul>
<li>This implies that the <strong>mean of the errors <span class="math inline">\(\epsilon_i\)</span></strong> is zero.</li>
<li>Tt applies only over the range of explanatory variables.</li>
</ul>
<p><strong>Assumption B: the scale of variability of the errors is constant at all values of the explanatory variables</strong></p>
<ul>
<li>Practically we are looking at whether the observations are equally spread on both side of the regression line.</li>
</ul>
<p><strong>Assumption C: the errors are independent</strong></p>
<ul>
<li>Broadly speaking this means that knowledge of errors attached to one observation does not give us any information about the error attached to another.</li>
</ul>
<p><strong>Assumptions D: the errors are normally distributed</strong></p>
<ul>
<li>This will allow us to describe the variation in the model’s parameters estimates and therefore make inferences about the population from which our sample was taken.</li>
</ul>
<p><strong>Assumption E: the values of the explanatory variables are recorded without error</strong></p>
<ul>
<li>This one is not possible to check via examining the data, instead we have to consider the nature of the experiment.</li>
</ul>
<section id="checking-assumptions" class="level3" data-number="1.12.1">
<h3 data-number="1.12.1" class="anchored" data-anchor-id="checking-assumptions"><span class="header-section-number">1.12.1</span> Checking assumptions</h3>
<p><strong>Residuals</strong>, <span class="math inline">\(\hat{\epsilon_i} = y_i - \hat{y_i}\)</span> are the <strong>main ingredient to check model assumptions</strong>. We use plots such as:</p>
<ol type="1">
<li>Histograms or normal probability plots of <span class="math inline">\(\hat{\epsilon_i}\)</span></li>
</ol>
<ul>
<li>useful to check the assumption of normality</li>
</ul>
<ol start="2" type="1">
<li>Plots of <span class="math inline">\(\hat{\epsilon_i}\)</span> versus the fitted values <span class="math inline">\(\hat{y_i}\)</span></li>
</ol>
<ul>
<li>used to detect changes in error variance</li>
<li>used to check if the mean of the errors is zero</li>
</ul>
<ol start="3" type="1">
<li>Plots of <span class="math inline">\(\hat{\epsilon_i}\)</span> vs.&nbsp;an explanatory variable <span class="math inline">\(x_{ij}\)</span></li>
</ol>
<ul>
<li>this helps to check that the variable <span class="math inline">\(x_j\)</span> has a linear relationship with the response variable</li>
</ul>
<ol start="4" type="1">
<li>Plots of <span class="math inline">\(\hat{\epsilon_i}\)</span> vs.&nbsp;an explanatory variable <span class="math inline">\(x_{kj}\)</span> that is <strong>not</strong> in the model</li>
</ol>
<ul>
<li>this helps to check whether the additional variable <span class="math inline">\(x_k\)</span> might have a relationship with the response variable</li>
</ul>
<ol start="4" type="1">
<li>Plots of <span class="math inline">\(\hat{\epsilon_i}\)</span> in the order of the observations were collected</li>
</ol>
<ul>
<li>this is useful to check whether errors might be correlated over time</li>
</ul>
<p>Let’s fit a simple model to predict <code>BMI</code> given <code>waist</code> for the diabetes study and see if the model meets the assumptions of linear models.</p>
<div class="cell" data-fig-cap-location="margin">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit simple linear regression model</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(BMI <span class="sc">~</span> waist, <span class="at">data =</span> data_diabetes)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot diagnostic plots of the linear model</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># by default plot(model) calls four diagnostics plots</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># par() divides plot window in 2 x 2 grid</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="lm-intro_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Default diagnostic residual plots based on the lm() model used to assess whether the assumptions of linear models are met. Simple regression to model BMI with waist explanatory variable.</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>The residual plots provides examples of a situation where the assumptions appear to be met.</li>
<li>The linear regression appears to describe data quite well.</li>
<li>There is no obvious trend of any kind in the residuals vs.&nbsp;fitted values (the shape is scattered) with potential few outliers that we may want to decided to exclude later.</li>
<li>Points lie reasonably well along the line in the normal probability plot, hence normality appears to be met.</li>
</ul>
<p><strong>Examples of assumptions not being met</strong></p>
<div class="cell" data-layout-align="center" data-fig-cap-location="margin">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/linear-models/lm-assumptions-01.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Example of data with a typical seasonal variation (up and down) coupled wtih a linear trend. The blue line gives the linear regression fit to the data, which clearly is not adequate. In comparison, if we used a non-parametric fit, we will get the red line as the fitted relationship. The residual plot retains pattern, given by orange line, indicating that the linear model is not appropriate in this case</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-fig-cap-location="margin">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/linear-models/lm-assumptions-02.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Example of non-constant variance</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center" data-fig-cap-location="margin">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/linear-models/lm-assumptions-03.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Example of residulas deviating from QQ plot, i.e.&nbsp;not following normal distribution. The residuals can deviate in both upper and lower tail. On the left tails are lighter meaning that they have smaller values that what would be expected, on the right there are heavier tails with values larger than expected</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="influential-observations" class="level3" data-number="1.12.2">
<h3 data-number="1.12.2" class="anchored" data-anchor-id="influential-observations"><span class="header-section-number">1.12.2</span> Influential observations</h3>
<ul>
<li>Sometimes individual observations can exert a great deal of influence on the fitted model.</li>
<li>One routine way of checking for this is to fit the model <span class="math inline">\(n\)</span> times, missing out each observation in turn.</li>
<li>If we removed i-th observation and compared the fitted value from the full model, say <span class="math inline">\(\hat{y_j}\)</span> to those obtained by removing this point, denoted <span class="math inline">\(\hat{y_{j(i)}}\)</span> then</li>
<li>observations with a high Cook’s distance (measuring the effect of deleting a given observation) could be influential.</li>
</ul>
<p>Let’s remove some observation with higher Cook’s distance from protein data set, re-fit our model and compare the diagnostics plots</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># observations to be removed (based on Residuals vs. Leverage plot)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">78</span>, <span class="dv">83</span>, <span class="dv">84</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit models removing observations</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>data_diabetes_flr <span class="ot">&lt;-</span> data_diabetes[<span class="sc">-</span>obs, ]</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>model_flr <span class="ot">&lt;-</span> <span class="fu">lm</span>(BMI <span class="sc">~</span> waist, <span class="at">data =</span> data_diabetes_flr)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot diagnostics plot</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_flr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="lm-intro_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="768"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./lm-reg-cls.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear models: regression and classification</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>