{
  "hash": "aa897929d0e95d458a4a1b6261d38446",
  "result": {
    "markdown": "---\noutput: html_document\neditor_options: \n  chunk_output_type: console\n---\n\n\n# Measures of location\n\n::: {.cell}\n\n```{.r .cell-code}\n# load libraries\nlibrary(tidyverse)\nlibrary(magrittr)\nlibrary(kableExtra)\nlibrary(faraway)\nlibrary(ggbeeswarm)\nlibrary(gridExtra)\nlibrary(reshape2)\n\n# define generic ggplot theme\nfont.size <- 12\ncol.blue.light <- \"#a6cee3\"\ncol.blue.dark <- \"#1f78b4\"\nmy.ggtheme <- theme(axis.title = element_text(size = font.size), \n        axis.text = element_text(size = font.size), \n        legend.text = element_text(size = font.size), \n        legend.title = element_blank(), \n        legend.position = \"top\", \n        axis.title.y = element_text(angle = 0)) \n\n# add obesity and diabetes status to diabetes faraway data\ninch2m <- 2.54/100\npound2kg <- 0.45\ndata_diabetes <- diabetes %>%\n  mutate(height  = height * inch2m, height = round(height, 2)) %>% \n  mutate(waist = waist * inch2m) %>%  \n  mutate(weight = weight * pound2kg, weight = round(weight, 2)) %>%\n  mutate(BMI = weight / height^2, BMI = round(BMI, 2)) %>% \n  mutate(obese= cut(BMI, breaks = c(0, 29.9, 100), labels = c(\"No\", \"Yes\"))) %>% \n  mutate(diabetic = ifelse(glyhb > 7, \"Yes\", \"No\"), diabetic = factor(diabetic, levels = c(\"No\", \"Yes\"))) %>%\n  na.omit()\n```\n:::\n\n\nIt is not always easy to get a \"feeling\" for a set of numerical measurements unless we summarize the data in a meaningful way. Diagrams, as shown in the previous chapter, are often a good starting point. We can further condense the information by reporting what constitutes a representative value. If we also know how widely scattered the observations are around it, we can formulate an image of data. The **average** is a general term for a measure of **location** and some common ways of calculating the average are mode, mean and median. \n\n## Mode\nMode values is the value that most common occurs across the measurements. It can be found for **numerical and categorical** data types. \n\nFor instance, we can find `age` mode value by counting how many times we observe each age value among the study participants. The mode values is the most commonly occurring one, here 63, with 9 participants being 63 at the time of the study. \n\n\n::: {#tbl-mode-age .cell .tbl-cap-location-bottom tbl-cap='Top three most observed age values among the study participants.'}\n\n```{.r .cell-code}\ndata_diabetes %>%\n  group_by(age) %>%\n  tally() %>%\n  arrange(desc(n)) %>%\n  slice(1:3) %>%\n  kbl() %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> age </th>\n   <th style=\"text-align:right;\"> n </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 40 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nAnalogously, we can find mode value for the categorical `diabetic status` by counting how many of the participants are diabetic and how many are not. Here, the mode is `No` with 100 study participants having glycosolated hemoglobin level lower than 7.0 and 30 above. \n\n\n::: {#tbl-mode-obese .cell .tbl-cap-location-bottom tbl-cap='Number of times diabetic status of No and Yes is observed for the study participants.'}\n\n```{.r .cell-code}\ndata_diabetes %>%\n  group_by(diabetic) %>%\n  tally() %>%\n  arrange(desc(n)) %>%\n  slice(1:3) %>%\n  kbl %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> diabetic </th>\n   <th style=\"text-align:right;\"> n </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> No </td>\n   <td style=\"text-align:right;\"> 100 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Yes </td>\n   <td style=\"text-align:right;\"> 30 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n## Median \nMedian value divides the **ordered** data values into two equally sized groups so that 50% of the values are below and 50% are above the median value. For the odd number of observations, the middle value is $(n+1)/2$-th term of the ordered observations. For even number of observations, it is the average of the middle two terms of the ordered observations.\n\n\\begin{equation}\n    Median =\n    \\left\\{\n        \\begin{array}{cc}\n                \\frac{(n+1)}{2}^{th} term & \\mathrm{if\\ } n \\mathrm{\\ is\\ odd} \\\\\n                \\frac{1}{2}\\times \\left (\\frac{n}{2}^{th} term + (\\frac{n}{2}+1)^{th} term \\right) & \\mathrm{if\\ } n \\mathrm{\\ is\\ even}  \\\\\n        \\end{array}\n    \\right.\n\\end{equation} \n\nFor instance, the median value for `age` for the first 10 study participants:\n\n::: {.cell .tbl-cap-location-margin tbl-cap='Age values for the first 10 study participants.'}\n\n```{.r .cell-code}\nage_10 <- data_diabetes %>%\n  slice(1:10)  # select first 10 participants\n\n# show age for 10 first participants\nage_10 %>%\n  select(id, age) %>% \n  pivot_wider(names_from = id, values_from = age) %>%\n  kbl() %>%\n  kable_styling() \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> 1002 </th>\n   <th style=\"text-align:right;\"> 1011 </th>\n   <th style=\"text-align:right;\"> 1016 </th>\n   <th style=\"text-align:right;\"> 1024 </th>\n   <th style=\"text-align:right;\"> 1036 </th>\n   <th style=\"text-align:right;\"> 1252 </th>\n   <th style=\"text-align:right;\"> 1253 </th>\n   <th style=\"text-align:right;\"> 1256 </th>\n   <th style=\"text-align:right;\"> 1271 </th>\n   <th style=\"text-align:right;\"> 1285 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 58 </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 45 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 70 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 66 </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 40 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\ncan be found by ordering observations: \n\n::: {.cell}\n\n```{.r .cell-code}\nage_10_ordered <- data_diabetes %>%\n  slice(1:10) %>% # select first 10 participants\n  arrange(age) %>% # order by age\n  pull(age) # extract ordered age observations\n\ndata_diabetes %>%\n  slice(1:10) %>% # select first 10 participants\n  arrange(age) %>%\n  select(id, age) %>% \n  pivot_wider(names_from = id, values_from = age) %>%\n  kbl() %>%\n  kable_styling() %>%\n  column_spec(c(5), background = \"gold\") %>%\n  column_spec(c(6), background = \"gold\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> 1271 </th>\n   <th style=\"text-align:right;\"> 1011 </th>\n   <th style=\"text-align:right;\"> 1036 </th>\n   <th style=\"text-align:right;\"> 1285 </th>\n   <th style=\"text-align:right;\"> 1016 </th>\n   <th style=\"text-align:right;\"> 1253 </th>\n   <th style=\"text-align:right;\"> 1002 </th>\n   <th style=\"text-align:right;\"> 1024 </th>\n   <th style=\"text-align:right;\"> 1256 </th>\n   <th style=\"text-align:right;\"> 1252 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 40 </td>\n   <td style=\"text-align:right;background-color: gold !important;\"> 45 </td>\n   <td style=\"text-align:right;background-color: gold !important;\"> 47 </td>\n   <td style=\"text-align:right;\"> 58 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:right;\"> 66 </td>\n   <td style=\"text-align:right;\"> 70 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nand averaging $5^{th}$ and $6^{th}$ term in the ordered observations giving a median value of: \n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n1/2*(age_10_ordered[5] + age_10_ordered[6])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 46\n```\n:::\n:::\n\n\nThe median value for `age` for the first 11 study participants:\n\n::: {.cell .tbl-cap-location-margin tbl-cap='Age values for the first 10 study participants.'}\n\n```{.r .cell-code}\nage_11 <- data_diabetes %>%\n  slice(1:11)  # select first 11 participants\n\n# show age for 10 first participants\nage_11 %>%\n  select(id, age) %>% \n  pivot_wider(names_from = id, values_from = age) %>%\n  kbl() %>%\n  kable_styling() \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> 1002 </th>\n   <th style=\"text-align:right;\"> 1011 </th>\n   <th style=\"text-align:right;\"> 1016 </th>\n   <th style=\"text-align:right;\"> 1024 </th>\n   <th style=\"text-align:right;\"> 1036 </th>\n   <th style=\"text-align:right;\"> 1252 </th>\n   <th style=\"text-align:right;\"> 1253 </th>\n   <th style=\"text-align:right;\"> 1256 </th>\n   <th style=\"text-align:right;\"> 1271 </th>\n   <th style=\"text-align:right;\"> 1285 </th>\n   <th style=\"text-align:right;\"> 1301 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 58 </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 45 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 70 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 66 </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 40 </td>\n   <td style=\"text-align:right;\"> 42 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\ncan be found by taking $6^{th}$ term from the ordered observations: \n\n::: {.cell}\n\n```{.r .cell-code}\nage_11_ordered <- data_diabetes %>%\n  slice(1:11) %>% # select first 11 participants\n  arrange(age) %>% # order by age\n  pull(age) # extract ordered age observations\n\ndata_diabetes %>%\n  slice(1:11) %>% # select first 11 participants\n  arrange(age) %>%\n  select(id, age) %>% \n  pivot_wider(names_from = id, values_from = age) %>%\n  kbl() %>%\n  kable_styling() %>%\n  column_spec(c(6), background = \"gold\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> 1271 </th>\n   <th style=\"text-align:right;\"> 1011 </th>\n   <th style=\"text-align:right;\"> 1036 </th>\n   <th style=\"text-align:right;\"> 1285 </th>\n   <th style=\"text-align:right;\"> 1301 </th>\n   <th style=\"text-align:right;\"> 1016 </th>\n   <th style=\"text-align:right;\"> 1253 </th>\n   <th style=\"text-align:right;\"> 1002 </th>\n   <th style=\"text-align:right;\"> 1024 </th>\n   <th style=\"text-align:right;\"> 1256 </th>\n   <th style=\"text-align:right;\"> 1252 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 40 </td>\n   <td style=\"text-align:right;\"> 42 </td>\n   <td style=\"text-align:right;background-color: gold !important;\"> 45 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 58 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:right;\"> 66 </td>\n   <td style=\"text-align:right;\"> 70 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\ngiving a median value of: \n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nage_11_ordered[6]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 45\n```\n:::\n:::\n\n\nAlternatively, we can use `median()` function to check our calculations:\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndata_diabetes %>%\n  dplyr::slice(1:10) %$%\n  median(age)\n## [1] 46\n\ndata_diabetes %>%\n  dplyr::slice(1:11) %$%\n  median(age)\n## [1] 45\n```\n:::\n\n\n\n## Arthimetic mean\n**The arithmetic mean**, also commonly referred to as  **mean**, is calculated by adding up all the values and diving the sum by the number of values in the data set.\n\nMathematically, for $n$ observations $x_1, x_2, \\dots, x_n$, the arithmetic mean value is calculated as:\n$$\\bar x = \\frac{x_1+x_2+\\dots+x_n}{n} = \\frac{1}{n}\\displaystyle\\sum_{i=1}^n x_i$$ {#eq-mean}\n\nTo calculate the arithmetic mean for `BMI` given our 130 study participants we can follow @eq-mean\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# calculate arithmetic mean following the equation\nx <- data_diabetes %>%\n  pull(BMI) # extract BMI observations\nn <- length(x) # number of observations\nx.bar <- sum(x) / n # calculate mean\nprint(x.bar)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 29.97962\n```\n:::\n\n```{.r .cell-code  code-fold=\"false\"}\nBMI_mean <- round(x.bar, 2)\n```\n:::\n\n\nor use basic `mean()` function in R:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ndata_diabetes %$%\n  mean(BMI) %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 29.97962\n```\n:::\n:::\n\n\n## Weighted mean\n\nAs all the values equally contribute to the calculations, the arithmetic mean value is easily affected by outliers and is distorted by skewed distributions. Sometimes, the **weighted mean** may be more useful, as it allows add weights to certain values of the variable of interest. We attach a weight, $w_i$ to each of the observed values, $x_i$, in our sample, to reflect this importance and define the weighted mean as: $$\\bar{x} = \\frac{w_1x_1 + w_2x_2 + \\ldots + w_nx_n}{w_1 + w_2 + \\ldots + w_n} = \\frac{\\displaystyle\\sum_{i=1}^{n}w_ix_i}{\\displaystyle\\sum_{i=1}^{n}w_i}$$ {#eq-mean-weighted}\n\nFor instance, we may be interested in knowing an average `BMI` value, irrespective of `gender`. It happens that among our study participants women are over represented: \n\n\n::: {.cell .tbl-cap-location-margin tbl-cap='Number of male and female study participans.'}\n\n```{.r .cell-code  code-fold=\"true\"}\ndata_diabetes %>%\n  group_by(gender) %>%\n  tally() %>%\n  kbl() %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> gender </th>\n   <th style=\"text-align:right;\"> n </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:right;\"> 57 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 73 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nAssuming BMI measurements for men and women should have equal influence (50/50), we can calculate `weighted BMI` mean to account for group sizes. We assign weights to BMI observations for men and women so that they sum up to 100. Since we have 73 measurements for women, the corresponding weights are $w_f = 50 / 73 = 0.6849315$ and $w_m = 50 / 57 = 0.877193$ for measurements reported for men. The weighted mean can now be calculated following @eq-mean-weighted and is equal to:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\n# number of women\nn_w <- data_diabetes%>%\n  filter(gender == \"female\") %>%\n  nrow()\n\n# number of men\nn_m <- data_diabetes%>%\n  filter(gender == \"male\") %>%\n  nrow()\n\n# add weights to observations\ndata_diabetes_addweights <- data_diabetes %>%\n  mutate(w = ifelse(gender == \"male\", 50/n_m, 50/n_w)) %>% # assign weights\n  mutate(wx = BMI * w)  # multiply weight by their weights values\n  \nnumerator <- data_diabetes_addweights %$%\n  sum(wx)\n\ndenominator <- data_diabetes_addweights %$%\n  sum(w)\n\nBMI_weighted_mean <- numerator / denominator\n  \nBMI_weighted_mean <- BMI_weighted_mean %>%\n  round(2) %>%\n  print()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 29.74\n```\n:::\n:::\n\n\n\nWe previously calculated BMI mean of 29.98 and mean BMI for men and women are:\n\n::: {.cell .tbl-cap-location-margin tbl-cap='Mean BMI values for men and women in the study.'}\n\n```{.r .cell-code}\ndata_diabetes %>%\n  group_by(gender) %>%\n  summarize(mean_BMI = mean(BMI)) %>%\n  kbl(digits = 2) %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> gender </th>\n   <th style=\"text-align:right;\"> mean_BMI </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> male </td>\n   <td style=\"text-align:right;\"> 27.77 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> female </td>\n   <td style=\"text-align:right;\"> 31.71 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe can note, as expected, that the weighted mean of BMI 29.74 is shifted slightly towards mean BMI for men since the BMI measurements for men have been assigned higher weights to account for women being overrepresented in the study. \n\n## Mean, median & outliers\n\nMedian is usually preferred when data has outliers as it follows from median definition that is less sensitive to outliers. On the other hand, mean value can be distorted when outliers are present. Let's add an outlying value of age (110) to the first 11 study participants, and re-calculate mean and median. \n\n\n::: {.cell .tbl-cap-location-margin tbl-cap='Comparision of mean and median age values before and after adding outlying age value of 110 to the first 11 study participants.'}\n\n```{.r .cell-code}\n# pull age values for the first 11 study participants\nage_11 <- data_diabetes %>%\n  slice(1:11) %>%\n  select(id, age) %>%\n  pull(age)\n  \n# add outlier value of 110\nage_11_with_outlier <- c(age_11, 110)\n\n# calculate mean and median, with and without outlier\n\n# without outlier\nage_mean_without <- mean(age_11) %>% round(2)\nage_median_without <- median(age_11)\n\n# with outlier\nage_mean_with <- mean(age_11_with_outlier) %>% round(2)\nage_median_with <- median(age_11_with_outlier)\n\nres <- data.frame(mean = c(age_mean_without, age_mean_with), \n                  median = c(age_median_without, age_median_with), \n                  row.names = c(\"without outlier\", \"with outlier\"))\n\nres %>%\n  kbl() %>%\n  kable_styling()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> mean </th>\n   <th style=\"text-align:right;\"> median </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> without outlier </td>\n   <td style=\"text-align:right;\"> 46.82 </td>\n   <td style=\"text-align:right;\"> 45 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> with outlier </td>\n   <td style=\"text-align:right;\"> 52.08 </td>\n   <td style=\"text-align:right;\"> 46 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nWe can see that adding one outlying age value shifted mean age from 46.82 to 52.08 while median age value did not change that much with original median value being 45 and 46 after adding the outlying value.\n\nIn addition, it is good to remember that several very different distributions can still have the same mean value.\n\n\n::: {.cell .fig-cap-location-margin}\n::: {.cell-output-display}\n![Examples of various distributions having the same mean value of 3.5](measures-of-location_files/figure-html/fig-mean-distr-1.png){#fig-mean-distr width=1152}\n:::\n:::\n",
    "supporting": [
      "measures-of-location_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}