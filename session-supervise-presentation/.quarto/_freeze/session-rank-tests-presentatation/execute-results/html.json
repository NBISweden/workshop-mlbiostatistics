{
  "hash": "681b2b32c6e17c32442d1e95b1fcea92",
  "result": {
    "markdown": "---\ntitle: \"Non-parametric rank based tests\"\n# author: Olga Dethlefsen\nformat: \n  revealjs:\n    slide-number: true\n    theme: [default, custom.scss]\n    chalkboard: \n      buttons: true\n  html:\n    code-fold: false\neditor_options: \n  chunk_output_type: console\nbibliography: references.bib\n---\n\n\n\n\n\n\n## Introduction\n\nHypothesis tests can be done via: \n\n::: incremental\n- resampling (to obtain the null distribution)\n- using parametric tests (when the null distribution is known)\n- non-parametric rank based tests (derived before computers empowered statistics)\n:::\n\n. . .\n\nNon-parametric rank based test are useful when:\n\n::: incremental\n- we do not know the underlying probability distribution and/or our data does not meet parametric test requirements\n- sample size is too small to properly assess the distribution of the data\n- transforming our data to meet the parametric test requirements would make interpretation of the results harder\n:::\n\n\n## Limitations\n\nSome limitations of the non-parametric rank based tests include the facts that:\n\n::: incremental\n- they are primary significance tests that often do not provide estimates of the effects of interest\n- they lead to waste of information and in consequence they have less power\n- when sample size are extremely small (e.g. $n=3$) rank tests cannot produce small *P*-values, even when the outcomes in the two groups are very different\n- non-parametric tests are less easily extended to situations where we wish to take into account the effect of more than one exposure on the outcome\n:::\n\n## Main non-parametric rank tests\n\n. . .\n\n- **Wilcoxon signed rank test**\n  - compares the sample median against a hypothetical median (equivalent to one sample *t*-test)\n  - or examine the difference between paired observations (equivalent to paired *t*-test)\n- **Wilcoxon rank sum test**\n  - examines the difference between two unrelated groups\n  - equivalent to two sample *t*-test\n- **Kruskal-Wallis one-way analysis of variance**\n  - examines the difference between two or more unrelated groups\n  - equivalent to ANOVA\n  \n. . .   \n\n**Rank based correlation**\n\n- **Spearman's rank correlation**\n  - Pearson's correlation coefficient calculated on ranks\n  \n. . .\n\n- **Kendall's rank correlation**\n  - based on number of concordant/discordant pairs\n  - alternative to Pearson correlation coefficient\n\n\n# Wilcoxon signed rank test  \n\n## Wilcoxon signed rank test \n\nNamed after Frank Wilcoxon (1892–1945), Wilcoxon signed rank test was one of the first \"non-parametric\" methods developed.\n\n. . .\n\n<br>\n\nIt can be used to:\n\n::: incremental\n  1. compare the sample median against a hypothetical median (equivalent to one sample *t*-test) \n  2. examine the difference between paired observations (equivalent to paired *t*-test). \n:::\n\n. . .\n\n<!-- It does make some assumptions about the data, namely:  -->\n\n<!-- ::: incremental   -->\n<!-- - the random variable X is continuous -->\n<!-- - the probability density function of X is symmetric -->\n<!-- ::: -->\n\n## Wilcoxon signed rank test {.smaller}\n*for a median*\n\n::: {#exm-wilcoxon-signed}\n## Wilcoxon signed rank test (for a median)\n\nLet's imagine we are a part of team analyzing results of a placebo-controlled clinical trial to test the effectiveness of a sleeping drug. We have collected data on 10 patients when they took a sleeping drug and when they took a placebo.\n\nThe hours of sleep recorded for each study participant: \n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover table\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> id </th>\n   <th style=\"text-align:right;\"> drug </th>\n   <th style=\"text-align:right;\"> placebo </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 6.1 </td>\n   <td style=\"text-align:right;\"> 5.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 6.0 </td>\n   <td style=\"text-align:right;\"> 7.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 8.2 </td>\n   <td style=\"text-align:right;\"> 3.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 7.6 </td>\n   <td style=\"text-align:right;\"> 4.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 6.5 </td>\n   <td style=\"text-align:right;\"> 5.3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 5.4 </td>\n   <td style=\"text-align:right;\"> 7.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 6.9 </td>\n   <td style=\"text-align:right;\"> 4.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:right;\"> 6.7 </td>\n   <td style=\"text-align:right;\"> 6.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 7.4 </td>\n   <td style=\"text-align:right;\"> 3.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 5.8 </td>\n   <td style=\"text-align:right;\"> 7.3 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n. . .\n\n<br>\nBefore we investigate the effect of drug, a senior statistician ask us: \n\n**\"Is the median sleeping time without taking the drug significantly less than the recommended 7 h of sleep?\"**\n\n## Wilcoxon signed rank test {.smaller}\n*for a median (cont.)*\n\n\n:::: {.columns}\n\n::: {.column width=\"40%\"}\n**Define the null and alternative hypothesis under the study**\n\n- $H_0: m = m_0$  the median sleeping time is equal to $m_0$, $m_0 = 7$ h\n- $H_1 < m_0$  the median sleeping time is less than $m_0$, $m_0 = 7$ h\n\n**Calculate the value of the test statistics**\n\n1. we subtract the median from each measurement, $X_i - m_0$\n2. we find absolute value of the difference, $|X_i - m_0|$\n3. we rank the absolute value of the difference\n4. we find the value of $W$, the Wilcoxon signed-rank test statistics as $$W =\\displaystyle \\sum_{i=1}^{n}Z_iR_i$$ where $Z_i$ is an indicator variable such as: \n\n\\begin{equation}\n    Z_i =\n    \\left\\{\n        \\begin{array}{cc}\n                0  & \\mathrm{if\\ } X_i - m_0 < 0 \\\\\n                1  &  otherwise \\\\\n        \\end{array}\n    \\right.\n\\end{equation}\n\n:::\n\n::: {.column width=\"60%\"}\n\n::: {#tbl-wilcoxon .cell .tbl-cap-location-margin tbl-cap='Demonstrating steps in the calculating W, Wilcoxon signed-rank test statistics on the placebo column: x stands for placebo sleeping hours'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover table\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> id </th>\n   <th style=\"text-align:right;\"> x </th>\n   <th style=\"text-align:right;\"> x-m0 </th>\n   <th style=\"text-align:right;\"> abs(x-m0) </th>\n   <th style=\"text-align:right;\"> R </th>\n   <th style=\"text-align:right;\"> Z </th>\n   <th style=\"text-align:right;\"> ZR </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 5.2 </td>\n   <td style=\"text-align:right;\"> -1.8 </td>\n   <td style=\"text-align:right;\"> 1.8 </td>\n   <td style=\"text-align:right;\"> 6.0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 7.9 </td>\n   <td style=\"text-align:right;\"> 0.9 </td>\n   <td style=\"text-align:right;\"> 0.9 </td>\n   <td style=\"text-align:right;\"> 3.5 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 3.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3.9 </td>\n   <td style=\"text-align:right;\"> -3.1 </td>\n   <td style=\"text-align:right;\"> 3.1 </td>\n   <td style=\"text-align:right;\"> 9.0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4.7 </td>\n   <td style=\"text-align:right;\"> -2.3 </td>\n   <td style=\"text-align:right;\"> 2.3 </td>\n   <td style=\"text-align:right;\"> 7.0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 5.3 </td>\n   <td style=\"text-align:right;\"> -1.7 </td>\n   <td style=\"text-align:right;\"> 1.7 </td>\n   <td style=\"text-align:right;\"> 5.0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 7.4 </td>\n   <td style=\"text-align:right;\"> 0.4 </td>\n   <td style=\"text-align:right;\"> 0.4 </td>\n   <td style=\"text-align:right;\"> 2.0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 2.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 4.2 </td>\n   <td style=\"text-align:right;\"> -2.8 </td>\n   <td style=\"text-align:right;\"> 2.8 </td>\n   <td style=\"text-align:right;\"> 8.0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:right;\"> 6.1 </td>\n   <td style=\"text-align:right;\"> -0.9 </td>\n   <td style=\"text-align:right;\"> 0.9 </td>\n   <td style=\"text-align:right;\"> 3.5 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 3.8 </td>\n   <td style=\"text-align:right;\"> -3.2 </td>\n   <td style=\"text-align:right;\"> 3.2 </td>\n   <td style=\"text-align:right;\"> 10.0 </td>\n   <td style=\"text-align:right;\"> 0 </td>\n   <td style=\"text-align:right;\"> 0.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 7.3 </td>\n   <td style=\"text-align:right;\"> 0.3 </td>\n   <td style=\"text-align:right;\"> 0.3 </td>\n   <td style=\"text-align:right;\"> 1.0 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1.0 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\"><span style=\"font-style: italic;\">Note: </span></td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> W = 6.5</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n::::\n\n\n## Wilcoxon signed rank test \n*for a median (cont.)*\n\n**Compare the value to the test statistics to values from known probability distribution**\n\n::: incremental\n- we got $W = 6.5$ and now we need to calculate the *P*-value associated with $W$ to be able to make decision about rejecting the null hypothesis. \n- we refer to a statistical table \"Upper and Lower Percentiles of the Wilcoxon Signed Rank Test, W\" that can be found online or [here](statstable/Wilcoxon-signed-rank-test.pdf).\n- we can see, at sample size $n=10$, that observing a *P*-value associated with observing $W=6.5$ is just under $0.019$\n- assuming 5% significance level, we have enough evidence to reject the null hypothesis and conclude that the median is significantly less than 7 hours. \n:::\n\n## Wilcoxon signed rank test \n*for a median (cont.)*\n\nWhere did that known distribution come from?\n\n::: incremental\n- Wilcoxon described and showed examples how to calculate both the test statistics $W$ for an example data as well as the distribution of $W$ under the null hypothesis @Wilcoxon1945\n- Let's try to find the distribution of W assuming we only have four observation ($n=4$)\n:::\n\n## Wilcoxon signed rank test {.smaller .scrollable}\n*for a median (cont.)...Where did that known distribution come from?*\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> c1 </th>\n   <th style=\"text-align:right;\"> c2 </th>\n   <th style=\"text-align:right;\"> c3 </th>\n   <th style=\"text-align:right;\"> c4 </th>\n   <th style=\"text-align:right;\"> c5 </th>\n   <th style=\"text-align:right;\"> c6 </th>\n   <th style=\"text-align:right;\"> c7 </th>\n   <th style=\"text-align:right;\"> c8 </th>\n   <th style=\"text-align:right;\"> c9 </th>\n   <th style=\"text-align:right;\"> c10 </th>\n   <th style=\"text-align:right;\"> c11 </th>\n   <th style=\"text-align:right;\"> c12 </th>\n   <th style=\"text-align:right;\"> c13 </th>\n   <th style=\"text-align:right;\"> c14 </th>\n   <th style=\"text-align:right;\"> c15 </th>\n   <th style=\"text-align:right;\"> c16 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> id1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> -1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> id4 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> -2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> -2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> -2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> -2 </td>\n   <td style=\"text-align:right;\"> -2 </td>\n   <td style=\"text-align:right;\"> -2 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> -2 </td>\n   <td style=\"text-align:right;\"> -2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> id3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n   <td style=\"text-align:right;\"> -3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> id4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> -4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> -4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> -4 </td>\n   <td style=\"text-align:right;\"> -4 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> -4 </td>\n   <td style=\"text-align:right;\"> -4 </td>\n   <td style=\"text-align:right;\"> -4 </td>\n   <td style=\"text-align:right;\"> -4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> W </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 10 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 9 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 8 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 7 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 6 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 7 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 6 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 5 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 5 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 3 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 4 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 4 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 3 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 2 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 1 </td>\n   <td style=\"text-align:right;font-weight: bold;color: black !important;background-color: #deebf7 !important;\"> 0 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n. . .\n\n<br>\n\n- Given 4 observations, we could get ranks $R_i$ of 1, 2, 3 or 4 only. Further, depending where the observation would be with respect to $m_0$, the rank $R_i$ could be positive or negative. For example, the first column $c1$ corresponds to all 4 observations having positive ranks, so all $x_i - m_0 > 0$, whereas column $c16$ corresponds to all observations having negative ranks, so $x_i - m_0 < 0$. \n\n. . .\n\n- As $W$ test statistics is derived by summing up the positive ranks, we can see by listing all the combinations in the table, that $0 \\le W \\le10$. \n\n. . . \n\n- We can also write down the probability mass function\n\n. . .\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> W </td>\n   <td style=\"text-align:left;\"> 0 </td>\n   <td style=\"text-align:left;\"> 1 </td>\n   <td style=\"text-align:left;\"> 2 </td>\n   <td style=\"text-align:left;\"> 3 </td>\n   <td style=\"text-align:left;\"> 4 </td>\n   <td style=\"text-align:left;\"> 5 </td>\n   <td style=\"text-align:left;\"> 6 </td>\n   <td style=\"text-align:left;\"> 7 </td>\n   <td style=\"text-align:left;\"> 8 </td>\n   <td style=\"text-align:left;\"> 9 </td>\n   <td style=\"text-align:left;\"> 10 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> p(W) </td>\n   <td style=\"text-align:left;\"> 0.0625 </td>\n   <td style=\"text-align:left;\"> 0.0625 </td>\n   <td style=\"text-align:left;\"> 0.0625 </td>\n   <td style=\"text-align:left;\"> 0.125 </td>\n   <td style=\"text-align:left;\"> 0.125 </td>\n   <td style=\"text-align:left;\"> 0.125 </td>\n   <td style=\"text-align:left;\"> 0.125 </td>\n   <td style=\"text-align:left;\"> 0.125 </td>\n   <td style=\"text-align:left;\"> 0.0625 </td>\n   <td style=\"text-align:left;\"> 0.0625 </td>\n   <td style=\"text-align:left;\"> 0.0625 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n. . .\n\n- And now we can use our knowledge from the Probability session on discrete distributions to calculate the probability of observed test statistics $W$ given the known probability mass function \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](session-rank-tests-presentatation_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n## Wilcoxon signed rank test \n*for a median (cont.)*\n\nIn `R` we use `wilcox.test()` function:\n\n```{.r}\n# run Wilcoxon signed rank test for a median\nwilcox.test(x = data.sleep$placebo, \n            y = NULL,\n            alternative = \"less\",\n            mu = 7,\n            paired = FALSE)\n            \n```\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWilcoxon signed rank test with continuity correction\n\ndata:  data.sleep$placebo\nV = 6.5, p-value = 0.01827\nalternative hypothesis: true location is less than 7\n```\n:::\n:::\n\n\n## Wilcoxon signed rank test {.smaller}\n*paired observations*\n\n::: {#exm-wilcoxon-signed}\n## Wilcoxon signed rank test (paired observations)\n\nLet's return to our placebo-controlled clinical trial to test the effectiveness of a sleeping drug. Again, the hours of sleep we recorded for each participants are: \n\nThe hours of sleep recorded for each study participant: \n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover table\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> id </th>\n   <th style=\"text-align:right;\"> drug </th>\n   <th style=\"text-align:right;\"> placebo </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 6.1 </td>\n   <td style=\"text-align:right;\"> 5.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 6.0 </td>\n   <td style=\"text-align:right;\"> 7.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 8.2 </td>\n   <td style=\"text-align:right;\"> 3.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 7.6 </td>\n   <td style=\"text-align:right;\"> 4.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 6.5 </td>\n   <td style=\"text-align:right;\"> 5.3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 5.4 </td>\n   <td style=\"text-align:right;\"> 7.4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 6.9 </td>\n   <td style=\"text-align:right;\"> 4.2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:right;\"> 6.7 </td>\n   <td style=\"text-align:right;\"> 6.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 7.4 </td>\n   <td style=\"text-align:right;\"> 3.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 5.8 </td>\n   <td style=\"text-align:right;\"> 7.3 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n<br>\n\n. . . \n\n**Is there enough evidence to reject a null hypothesis of the median of the differences between the paired observations being equal to 0? I.e. is the drug having an effect?**\n\n## Wilcoxon signed rank test\n*paired observations*\n\nDefine the null and alternative hypothesis under the study\n\n- $H_0:$  the median difference in the population equals to zero\n- $H_1:$  the median difference in the population does not equals to zero\n\n## Wilcoxon signed rank test {.smaller}\n*paired observations*\n\n:::: {.columns}\n\n::: {.column width=\"40%\"}\nTo calculate test statistics:\n\n- calculate difference and exclude differences that equal to 0\n- rank difference in ascending order, ignoring the sign, e.g. the smallest difference value, here 0.6 is ranked 1. \n- sum up the ranks of the negative differences and of positive differences and denote these sums by $T_{-}$ and $T_{+}$ respectively\n- Why? If there were no differences in effectiveness between the sleeping drug and the placebo then the sums $T_{-}$ and $T_{+}$ would be similar. **If there were a difference then one sum would be much smaller and one sum would be much larger than expected.**\n- we get $T_{-} = 40$ and $T_{+} = 15$\n- denote the smaller sum by T and interpret the *P*-value, here $T = 15$\n\n:::\n\n::: {.column width=\"60%\"}\n\n::: {#tbl-wilcoxon-ii .cell .tbl-cap-location-margin tbl-cap='Demonstrating steps in the calculating W, Wilcoxon signed-rank test statistics for difference in mean (paired observations)'}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover table\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> id </th>\n   <th style=\"text-align:right;\"> drug </th>\n   <th style=\"text-align:right;\"> placebo </th>\n   <th style=\"text-align:right;\"> diff </th>\n   <th style=\"text-align:right;\"> rank </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 6.1 </td>\n   <td style=\"text-align:right;\"> 5.2 </td>\n   <td style=\"text-align:right;\"> 0.9 </td>\n   <td style=\"text-align:right;\"> 2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 6.0 </td>\n   <td style=\"text-align:right;\"> 7.9 </td>\n   <td style=\"text-align:right;\"> -1.9 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 8.2 </td>\n   <td style=\"text-align:right;\"> 3.9 </td>\n   <td style=\"text-align:right;\"> 4.3 </td>\n   <td style=\"text-align:right;\"> 10 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 7.6 </td>\n   <td style=\"text-align:right;\"> 4.7 </td>\n   <td style=\"text-align:right;\"> 2.9 </td>\n   <td style=\"text-align:right;\"> 8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 6.5 </td>\n   <td style=\"text-align:right;\"> 5.3 </td>\n   <td style=\"text-align:right;\"> 1.2 </td>\n   <td style=\"text-align:right;\"> 3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 5.4 </td>\n   <td style=\"text-align:right;\"> 7.4 </td>\n   <td style=\"text-align:right;\"> -2.0 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 6.9 </td>\n   <td style=\"text-align:right;\"> 4.2 </td>\n   <td style=\"text-align:right;\"> 2.7 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:right;\"> 6.7 </td>\n   <td style=\"text-align:right;\"> 6.1 </td>\n   <td style=\"text-align:right;\"> 0.6 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 7.4 </td>\n   <td style=\"text-align:right;\"> 3.8 </td>\n   <td style=\"text-align:right;\"> 3.6 </td>\n   <td style=\"text-align:right;\"> 9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 5.8 </td>\n   <td style=\"text-align:right;\"> 7.3 </td>\n   <td style=\"text-align:right;\"> -1.5 </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\"><span style=\"font-style: italic;\">Note: </span></td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> T(-)=40$ , T(+) = 15</td></tr>\n</tfoot>\n</table>\n\n`````\n:::\n:::\n\n:::\n\n::::\n\n\n\n## Wilcoxon signed rank test \n*paired observations*\n\n::: incremental\n\n- The \"Critical values for the Wilcoxon matched pairs signed rank test\" table can be found online or [here](statstable/Wilcoxon-signed-rank-test-pairs-T-distribution.pdf)\n\n- **The Wilcoxon signed rank test is based on assessing whether $T$, the smaller of $T_{-}$ and $T_{+}$, is smaller than would be expected by chance, under the null hypothesis that the median of the paired differences is zero.** \n\n- The hypothesis is that $T$ is equal to the sum of the ranks divided by 2, so that the smaller $T$ the more evidence there is against the null hypothesis. \n\n- Having our $T$ value we can check what is the probability of observing the value of $T$ under the null hypothesis, by checking the statistical table of \"Critical values for the Wilcoxon matched pairs signed rank test\".\n\n- In our example, the sample size $n=10$, where $n$ is the number of non-zero differences (we had none) and 5% percentage point is 8. Since $T=15 > 8$ our $P-value > 0.05$ and we do not have enough evidence to reject the null hypothesis. There is no evidence of the sleeping drug working. \n\n:::\n\n## Wilcoxon signed rank test \n*paired observations*\n\nIn `R` we use `wilcox.test()` function adjusting `paired` argument.\n\nBefore, Wilcoxon signed rank test for a median\n```{.r}\n# run Wilcoxon signed rank test for a median\nwilcox.test(x = data.sleep$placebo, \n            y = NULL,\n            alternative = \"less\",\n            mu = 7,\n            paired = FALSE)\n```\n\n. . .\n\n\nNow, Wilcoxon signed rank test for paired observations \n```{.r code-line-numbers=\"3|4|5|6\"}\n# run Wilcoxon signed rank test for paired observations \nwilcox.test(x = data.sleep$placebo, \n            y = data.sleep$drug,\n            alternative = \"two.sided\",\n            mu = 0,\n            paired = TRUE)\n```\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWilcoxon signed rank test with continuity correction\n\ndata:  data.sleep$placebo and data.sleep$drug\nV = 15, p-value = 0.2213\nalternative hypothesis: true location shift is not equal to 0\n```\n:::\n:::\n\n\n\n# 2 or more unrelated groups\n\n## Wilcoxon rank sum test & Krusall-Wallis\n\n\n:::: {.columns}\n\n::: {.column width=\"40%\"}\n**Wilcoxon rank sum test**\n\n- test statistics, $T$, is the sum or ranks in the smaller group\n- refer to table “Critical range for the Wilcoxon rank sum test” found online or [here](statstable/Wilcoxon-rank-sum-test.pdf)\n\n**Kruskall-Wallis**\n\n- can be seen as extension of Wilcoxon rank sum test to $k≥2$ groups\n- for $k=2$ gives the same results as Wilcoxon rank sum test\n- the sums of the ranks in each of the $k$ groups should be comparable after allowing for any differences in sample size.\n\n\nMore details and examples in the chapter.\n:::\n\n::: {.column width=\"60%\"}\n\n<br>\n<br>\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-paper lightable-hover table\" style='font-family: \"Arial Narrow\", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> id </th>\n   <th style=\"text-align:right;\"> weight </th>\n   <th style=\"text-align:left;\"> smoking </th>\n   <th style=\"text-align:right;\"> rank </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 1 </td>\n   <td style=\"text-align:right;\"> 3.99 </td>\n   <td style=\"text-align:left;\"> No </td>\n   <td style=\"text-align:right;\"> 11 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 3.89 </td>\n   <td style=\"text-align:left;\"> No </td>\n   <td style=\"text-align:right;\"> 10 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 3 </td>\n   <td style=\"text-align:right;\"> 3.60 </td>\n   <td style=\"text-align:left;\"> No </td>\n   <td style=\"text-align:right;\"> 8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 3.73 </td>\n   <td style=\"text-align:left;\"> No </td>\n   <td style=\"text-align:right;\"> 9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 3.31 </td>\n   <td style=\"text-align:left;\"> No </td>\n   <td style=\"text-align:right;\"> 7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 3.18 </td>\n   <td style=\"text-align:left;\"> Yes </td>\n   <td style=\"text-align:right;\"> 5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 2.74 </td>\n   <td style=\"text-align:left;\"> Yes </td>\n   <td style=\"text-align:right;\"> 2 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 8 </td>\n   <td style=\"text-align:right;\"> 2.90 </td>\n   <td style=\"text-align:left;\"> Yes </td>\n   <td style=\"text-align:right;\"> 3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 3.27 </td>\n   <td style=\"text-align:left;\"> Yes </td>\n   <td style=\"text-align:right;\"> 6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 3.15 </td>\n   <td style=\"text-align:left;\"> Yes </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 11 </td>\n   <td style=\"text-align:right;\"> 2.42 </td>\n   <td style=\"text-align:left;\"> Yes </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\n::::\n\n\n# Correlation\n\n## Pearson correleation coefficient {.smaller .scrollable}\n\nPearson correlation coefficient, or rather more correctly Pearson product moment correlation coefficient, gives us an idea about the strength of association between two numerical variables. Its true value in the population, $\\rho$, is estimated in the sample by $r$, where:\n\n\n$$r=\\frac{\\sum(x-\\bar{x})(x-\\bar{y})}{\\sqrt{\\sum(x-\\bar{x})^2\\sum(x-\\bar{y})^2}}$${#eq-pearson}\n\n::: {.cell}\n::: {.cell-output-display}\n![](session-rank-tests-presentatation_files/figure-revealjs/unnamed-chunk-12-1.png){width=960}\n:::\n:::\n\n## Spearman and Kendal tau {.smaller}\n\n**Spearman's rank correlation** \n\n. . . \n\nTo calculate Spearman's rank correlation between two variables $X$ and $Y$ we: \n\n- rank the values of $X$ and $Y$ independently\n\n. . .\n\n- follow the formula to calculate the Pearson correlation coefficient using ranks \n\n. . .\n\n**Kendall's tau**\n\nTo calculate Kendall's tau, $\\tau$, we compare ranks of $X$ and $Y$ between every pair of observation. (There are n(n-1)/2 possible pairs). The pairs of ranks for observation $i$ and $j$ are said to be: \n\n- concordant: if they differ in the same direction, i.e. if both the $X$ and $Y$ ranks of subject $i$ are lower than the corresponding ranks of subject $j$, or both are higher\n- discordant: otherwise\n\n$$\\tau = \\frac{n_C-n_D}{n(n-1)/2}$$ where \n\n\n$n_C$, number of concordant pairs\n$n_D$, number of discordant pairs\n\n. . .\n\n:::{.callout-tip}\n## Kendall $\\tau$\n\nAlthough Spearman correlation coefficient is commonly used it may be easier to build intuitive understanding of Kendall $\\tau$. A positive correlation indicates \nthat the ranks of both variables increase together whilst a negative correlation indicates that as the rank of one variable increases the other one decreases\n\n:::\n\n## Summary\n\n::: incremental\n\n- Non-parametric rank based tests still have their place in modern data analysis\n- They are based on a neat idea of turning data into ranks that is useful when sample is small or when parametric based test assumptions cannot be met\n- Spearman correlation is perhaps used as a first choice when Pearson correlation coefficient should not be calculated. However Kendall tau's offers much easier interpretation, with positive correlation indicating that the ranks of both variables increase together\n:::\n\n\n## References\n::: {#refs}\n:::\n\n## Thank you for listening\n*Any questions?*\n\n\n\n\n\n",
    "supporting": [
      "session-rank-tests-presentatation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"session-rank-tests-presentatation_files/libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"session-rank-tests-presentatation_files/libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}